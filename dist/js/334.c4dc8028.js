"use strict";(self["webpackChunkvue_crm"]=self["webpackChunkvue_crm"]||[]).push([[334],{3334:function(e,t,i){i.r(t),i.d(t,{default:function(){return D}});var l=i(3396),a=i(7139),n=i(9242);const s={class:"page-title"},o={key:1,class:"center"},u={class:"input-field"},c=["value"],r={class:"input-field"},d={for:"amount"},p={class:"input-field"},m={for:"description"},h={class:"btn waves-effect waves-light",type:"submit"},w=(0,l._)("i",{class:"material-icons right"},"send",-1);function y(e,t,i,y,g,f){const _=(0,l.up)("Loader"),v=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",s,[(0,l._)("h3",null,(0,a.zw)(e.$localize("NewRecord")),1)]),e.loading?((0,l.wg)(),(0,l.j4)(_,{key:0})):e.categories.length?((0,l.wg)(),(0,l.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,n.iM)(((...e)=>f.onSubmit&&f.onSubmit(...e)),["prevent"]))},[(0,l._)("div",u,[(0,l.wy)((0,l._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=t=>e.category=t)},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.categories,(e=>((0,l.wg)(),(0,l.iD)("option",{key:e.id,value:e.id},(0,a.zw)(e.name),9,c)))),128))],512),[[n.bM,e.category]]),(0,l._)("label",null,(0,a.zw)(e.$localize("Cat_Choose")),1)]),(0,l._)("p",null,[(0,l._)("label",null,[(0,l.wy)((0,l._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=t=>e.type=t)},null,512),[[n.G2,e.type]]),(0,l._)("span",null,(0,a.zw)(e.$localize("Income")),1)])]),(0,l._)("p",null,[(0,l._)("label",null,[(0,l.wy)((0,l._)("input",{class:"with-gap",name:"type",type:"radio",value:"cost","onUpdate:modelValue":t[2]||(t[2]=t=>e.type=t)},null,512),[[n.G2,e.type]]),(0,l._)("span",null,(0,a.zw)(e.$localize("Cost")),1)])]),(0,l._)("div",r,[(0,l.wy)((0,l._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=t=>e.amount=t),class:(0,a.C_)({invalid:y.v$.amount.$error})},null,2),[[n.nr,e.amount,void 0,{number:!0}]]),(0,l._)("label",d,(0,a.zw)(e.$localize("Amount")),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(y.v$.amount.$errors,(t=>((0,l.wg)(),(0,l.iD)("span",{class:"helper-text invalid",key:t.$uid},(0,a.zw)(e.$localize("EnterAmount")),1)))),128))]),(0,l._)("div",p,[(0,l.wy)((0,l._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=t=>e.description=t)},null,512),[[n.nr,e.description]]),(0,l._)("label",m,(0,a.zw)(e.$localize("Description")),1)]),(0,l._)("button",h,[(0,l.Uk)((0,a.zw)(e.$localize("Create"))+" ",1),w])],32)):((0,l.wg)(),(0,l.iD)("p",o,[(0,l.Uk)((0,a.zw)(e.$localize("Cat_Message"))+" ",1),(0,l.Wm)(v,{to:"/categories"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.$localize("Cat_Message_Add")),1)])),_:1})]))])}var g=i(5797),f=i(2112),_=i(9117),v=i(65),$=i(2350),b=i(6316),z={setup(){return(0,$.Kf)({title:(0,l.Fl)((()=>(0,b.Z)("ProfileTitle")))}),{v$:(0,f.ZP)()}},name:"record",data:()=>({categories:[],loading:!0,select:null,category:null,type:"cost",amount:1,description:""}),validations:{amount:{required:_.C1,minValue:(0,_.uv)(1),$autoDirty:!0}},async mounted(){this.categories=await this.$store.dispatch("fetchCategories"),this.category=this.categories[0].id||null,this.loading=!1,setTimeout((()=>{this.select=g.FormSelect.init(this.$refs.select),(0,g.updateTextFields)()}),0)},unmounted(){this.select&&this.select.unmounted&&this.select.unmounted()},computed:{...(0,v.Se)(["info"]),canCreateRecord(){return"income"===this.type||this.info.bill>=this.amount}},methods:{async onSubmit(){const e=await this.v$.$validate();if(e)if(this.canCreateRecord){const e={date:(new Date).toJSON(),amount:this.amount,description:this.description,categoryId:this.category,type:this.type};try{await this.$store.dispatch("createRecord",e);const t="income"===this.type?this.info.bill+this.amount:this.info.bill-this.amount;await this.$store.dispatch("updateInfo",{bill:t}),this.$message("Запись успешно создана"),this.v$.$reset(),this.amount=1,this.description=""}catch(t){}}else this.$message("Недостаточно средств на счете. Не хватает "+(this.amount-this.info.bill))}}},k=i(89);const C=(0,k.Z)(z,[["render",y]]);var D=C}}]);
//# sourceMappingURL=334.c4dc8028.js.map