{"version":3,"file":"js/334.c4dc8028.js","mappings":"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","sources":["webpack://vue-crm/./src/views/RecordView.vue","webpack://vue-crm/./src/views/RecordView.vue?5489"],"sourcesContent":["<template>\n  <div>\n    <div class=\"page-title\">\n      <h3>{{ $localize('NewRecord') }}</h3>\n    </div>\n    <Loader v-if=\"loading\" />\n    <p v-else-if=\"!categories.length\" class=\"center\">\n      {{ $localize('Cat_Message') }}\n      <router-link to=\"/categories\">{{\n        $localize('Cat_Message_Add')\n      }}</router-link>\n    </p>\n    <form class=\"form\" v-else @submit.prevent=\"onSubmit\">\n      <div class=\"input-field\">\n        <select ref=\"select\" v-model=\"category\">\n          <option\n            v-for=\"option of categories\"\n            :key=\"option.id\"\n            :value=\"option.id\"\n          >\n            {{ option.name }}\n          </option>\n        </select>\n        <label>{{ $localize('Cat_Choose') }}</label>\n      </div>\n\n      <p>\n        <label>\n          <input\n            class=\"with-gap\"\n            name=\"type\"\n            type=\"radio\"\n            value=\"income\"\n            v-model=\"type\"\n          />\n          <span>{{ $localize('Income') }}</span>\n        </label>\n      </p>\n\n      <p>\n        <label>\n          <input\n            class=\"with-gap\"\n            name=\"type\"\n            type=\"radio\"\n            value=\"cost\"\n            v-model=\"type\"\n          />\n          <span>{{ $localize('Cost') }}</span>\n        </label>\n      </p>\n\n      <div class=\"input-field\">\n        <input\n          id=\"amount\"\n          type=\"number\"\n          v-model.number=\"amount\"\n          :class=\"{ invalid: v$.amount.$error }\"\n        />\n        <label for=\"amount\">{{ $localize('Amount') }}</label>\n        <span\n          class=\"helper-text invalid\"\n          v-for=\"error of v$.amount.$errors\"\n          :key=\"error.$uid\"\n          >{{ $localize('EnterAmount') }}</span\n        >\n      </div>\n\n      <div class=\"input-field\">\n        <input id=\"description\" type=\"text\" v-model=\"description\" />\n        <label for=\"description\">{{ $localize('Description') }}</label>\n      </div>\n\n      <button class=\"btn waves-effect waves-light\" type=\"submit\">\n        {{ $localize('Create') }}\n        <i class=\"material-icons right\">send</i>\n      </button>\n    </form>\n  </div>\n</template>\n\n<script>\nimport { FormSelect, updateTextFields } from 'materialize-css'\nimport useVuelidate from '@vuelidate/core'\nimport { required, minValue } from '@vuelidate/validators'\nimport { computed } from 'vue'\nimport { mapGetters } from 'vuex'\nimport { useHead } from '@vueuse/head'\nimport localize from '@/utils/localize'\n\nexport default {\n  setup() {\n    useHead({\n      title: computed(() => localize('ProfileTitle'))\n    })\n    return { v$: useVuelidate() }\n  },\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: 'record',\n  data: () => ({\n    categories: [],\n    loading: true,\n    select: null,\n    category: null,\n    type: 'cost',\n    amount: 1,\n    description: '',\n  }),\n  validations: {\n    amount: { required, minValue: minValue(1), $autoDirty: true },\n  },\n  async mounted() {\n    this.categories = await this.$store.dispatch('fetchCategories')\n    this.category = this.categories[0].id || null\n    this.loading = false\n    //для того, чтобы селект успел появиться на странице после лоадера нужен таймаут\n    setTimeout(() => {\n      this.select = FormSelect.init(this.$refs.select)\n      updateTextFields()\n    }, 0)\n  },\n  unmounted() {\n    if (this.select && this.select.unmounted) {\n      this.select.unmounted()\n    }\n  },\n  computed: {\n    ...mapGetters(['info']),\n    canCreateRecord() {\n      if (this.type === 'income') {\n        return true\n      }\n      return this.info.bill >= this.amount\n    },\n  },\n  methods: {\n    async onSubmit() {\n      const isFormCorrect = await this.v$.$validate()\n      if (!isFormCorrect) return\n      if (this.canCreateRecord) {\n        const formData = {\n          date: new Date().toJSON(), //чтобы корректно сохранил firebase\n          amount: this.amount,\n          description: this.description,\n          categoryId: this.category,\n          type: this.type,\n        }\n        try {\n          await this.$store.dispatch('createRecord', formData)\n          const bill =\n            this.type === 'income'\n              ? this.info.bill + this.amount\n              : this.info.bill - this.amount\n          await this.$store.dispatch('updateInfo', { bill })\n          this.$message(`Запись успешно создана`)\n          this.v$.$reset()\n          this.amount = 1\n          this.description = ''\n          // eslint-disable-next-line no-empty\n        } catch (e) {}\n      } else {\n        this.$message(\n          `Недостаточно средств на счете. Не хватает ${\n            this.amount - this.info.bill\n          }`\n        )\n      }\n    },\n  },\n}\n</script>\n","import { render } from \"./RecordView.vue?vue&type=template&id=2d2916da\"\nimport script from \"./RecordView.vue?vue&type=script&lang=js\"\nexport * from \"./RecordView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\nprokof\\\\Documents\\\\learnVueJS\\\\vue-crm\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","for","type","_createElementVNode","_createElementBlock","_toDisplayString","_ctx","_createBlock","_component_Loader","key","length","onSubmit","$options","ref","$event","_Fragment","_renderList","option","id","value","name","_hoisted_4","invalid","$setup","amount","$error","$errors","error","$uid","_hoisted_10","_createVNode","_component_router_link","to","setup","useHead","title","computed","localize","v$","useVuelidate","data","categories","loading","select","category","description","validations","required","minValue","$autoDirty","async","this","$store","dispatch","setTimeout","FormSelect","$refs","updateTextFields","unmounted","mapGetters","canCreateRecord","info","bill","methods","isFormCorrect","$validate","formData","date","Date","toJSON","categoryId","$message","$reset","e","__exports__","render"],"sourceRoot":""}